# Production Login Fix Instructions

## Method 1: Using Vercel (Recommended if you're using Vercel)

1. **Install Vercel CLI** (if not already installed):
   ```bash
   npm i -g vercel
   ```

2. **Login to Vercel**:
   ```bash
   vercel login
   ```

3. **Connect to your production database**:
   ```bash
   vercel env pull .env.production
   ```

4. **Run the fix script with production database**:
   ```bash
   # This uses your production DATABASE_URL from .env.production
   NODE_ENV=production node --env-file=.env.production scripts/production-fix-login.js
   ```

## Method 2: Direct Database Access (if you have database credentials)

1. **Set your production DATABASE_URL**:
   ```bash
   export DATABASE_URL="your-production-database-url-here"
   ```

2. **Run the fix script**:
   ```bash
   node scripts/production-fix-login.js
   ```

## Method 3: Using Prisma Studio (Visual Method)

1. **Connect to production database**:
   ```bash
   DATABASE_URL="your-production-database-url" npx prisma studio
   ```

2. **Manual steps in Prisma Studio**:
   - Go to the `User` table
   - Find or create user "Niblah"
   - The password hash for "Jukovic91!" is: `$2a$10$` (this will be generated by the script)
   - Clear all records in `LoginAttempt` table
   - Clear all records in `Session` table

## Method 4: Deploy as a One-Time Script

1. **Create a temporary API endpoint** `/api/fix-login` (for one-time use):
   
   Create file: `src/app/api/fix-login/route.js`
   ```javascript
   import { NextResponse } from 'next/server';
   import { PrismaClient } from '@prisma/client';
   import bcrypt from 'bcryptjs';

   const prisma = new PrismaClient();

   export async function GET(request) {
     // Add security check
     const authHeader = request.headers.get('authorization');
     if (authHeader !== 'Bearer your-secret-key-here') {
       return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });
     }

     // Run the fix
     const passwordHash = await bcrypt.hash('Jukovic91!', 10);
     
     await prisma.loginAttempt.deleteMany({});
     
     await prisma.user.upsert({
       where: { username: 'Niblah' },
       update: { passwordHash, email: 'admin@admin.nl' },
       create: { username: 'Niblah', passwordHash, email: 'admin@admin.nl', role: 'ADMIN' }
     });
     
     await prisma.session.deleteMany({});
     
     return NextResponse.json({ success: true, message: 'Login fixed!' });
   }
   ```

2. **Deploy to production**:
   ```bash
   git add .
   git commit -m "Add one-time login fix endpoint"
   git push
   ```

3. **After deployment, trigger the fix**:
   ```bash
   curl -H "Authorization: Bearer your-secret-key-here" https://your-domain.com/api/fix-login
   ```

4. **IMPORTANT: Remove the endpoint after use**:
   ```bash
   git rm src/app/api/fix-login/route.js
   git commit -m "Remove temporary fix endpoint"
   git push
   ```

## Verification

After running any of these methods, verify the fix worked:

1. Go to your production site: `https://your-domain.com/admin/login`
2. Login with:
   - Username: `Niblah`
   - Password: `Jukovic91!`

## Troubleshooting

If you still can't login:
- Check that the script ran successfully without errors
- Verify the production database was actually updated
- Clear your browser cache and cookies
- Check the browser console for any errors

## Security Notes

- Never commit sensitive credentials to git
- Delete any temporary fix scripts after use
- Consider changing the password after initial login
- Set up proper environment variables for production